STACKS SEGMENT STACK 'STACK'
  DW 64 DUP(0)
STACKS ENDS

DATA SEGMENT PUBLIC 'DATA'
  LOAD_FILE	DB 'CHKDSK.COM', 0
  PAR_BLK	DW 0
		DW OFFSET CMD_LINE
		DW SEG CMD_LINE
		DD -1
		DD -1
  CMD_LINE	DB 9, '/?', 0DH
  ERR_MSG_1	DB 'MEMORY ALLOCATION ERROR', 0DH, 0AH, '$'
  ERR_MSG_2	DB 'EXEC CALL ERROR', 0DH, 0AH, '$'
DATA ENDS

CODE SEGMENT PUBLIC 'CODE'
  ASSUME        CS: CODE, DS: DATA, SS: STACKS
  START:
    MOV AX, DATA
    MOV DS, AX
    MOV BX, 100H
    MOV AH, 4AH
    INT 21H
    JC ERROR_1
    MOV AH, 48H
    MOV BX, 0FFFFH
    INT 21H
    CMP BX, 60H
    JB ERROR_2
    MOV CS: MEM_SIZE, BX
    PUSH ES
    PUSH DS
    PUSH DS
    POP ES
    MOV CS: STK_SEG, SS
    MOV CS: STK_PTR, SP
    MOV DX, OFFSET LOAD_FILE
    MOV BX, OFFSET PAR_BLK
    MOV AL, 0
    MOV AH, 4BH
    INT 21H
    MOV SS, CS: STK_SEG
    MOV SP, CS: STK_PTR
    POP DS
    POP ES
    JNC EXIT
    JMP ERROR_2
  ERROR_1:
    MOV DX, OFFSET ERR_MSG_1
    JMP DISP
  ERROR_2:
    MOV DX, OFFSET ERR_MSG_2
  DISP:
    MOV AH, 9
    INT 21H
  EXIT:
    MOV AX, 4C00H
    INT 21H
  MEM_SIZE	DW 0
  STK_SEG	DW 0
  STK_PTR	DW 0
CODE ENDS
  END START
