#include <dir.h>
#include <dos.h>
#include <time.h>
#include <bios.h>
#include <conio.h>
#include <alloc.h>
#include <ctype.h>
#include <string.h>
#include <stdio.h>
#include <stdlib.h>

#include <source\module\tdvideoa.cpp>

#define MAXX	5		// *8
#define MAXY	20
#define DEFMAXX	1
#define DEFMAXY	16
#define MAXRING	16

enum {False = 0, True} Boolean;
enum {Horiz = 0, Vert} Direction;
enum {View = 0, Draw, Erase, Invert} PenStatus;
enum {Dec = 0, Hex, Oct, WDec, WHex, WOct} NumFormat;

class icon {
  enum	Boolean ringactive;
  int	rstart, rend;
  void	ringleft(), ringright();
  void	xcopy(int, int), ycopy(int, int);
public:
	icon(int, int);
  enum	PenStatus pen;
  int	ring;
  int	x, y, maxx, maxy;
  Byte	map[MAXRING][MAXX][MAXY];
  int	getp(int, int), setp(int, int, int);
  int	noring();
  int	valid(), modify();
  void	clear(), full(), noise(), invert();
  void	left(int), right(int), up(int), down(int);
  void	cutleft(int), cutright(int), cutup(int), cutdown(int);
  void	invertx(), inverty(), scalex(int), scaley(int);
  void	rotate(int);
  void	slipleft(int), slipright(int), slipup(int), slipdown(int);
  void	outline(), line(int, int, int, int);
  void	rect(int, int, int, int), box(int, int, int, int);
  void	circle(int, int, int, int), ellipse(int, int, int, int);
  void	fill(), fillxy(int, int, int);
  int	undo(), redo();
public:
  icon	*prev, *next;
} iconbuf(DEFMAXX, DEFMAXY), iconfill(DEFMAXX, DEFMAXY);

struct iconfile {
	iconfile();
  char	filename[128];
  enum	Boolean brace, comments, newline;
  enum	Direction dir;
  enum	NumFormat nf;
  char	sep[256];
  long	getnum(FILE *);
  int	save(), load();
} myfile;

class icons {
  icon	*_i;
  int	count();
public:
	icons();
  icon	*i;
  long	left;
  int	curpage, totalpages;
  int	defmaxx, defmaxy;
  enum	Boolean changed, statusbar, autoclear;
  int	prev(), next();
  void	top(), bottom();
  int	add(int, int), ins(int, int), del(), clear();
public:
  int	incw(int), inch(int);
  void	curop(), curinvert();
  void	curhome(), curend(), curmostup(), curmostdown();
  void	curleft(), curright(), curup(), curdown();
  void	refresh(int clr = 0);
} myicons;

class misc {
public:
  void	welcome(), help();
  void	fileset(), sysset(), fontset();
  int	askexit();
  void	exit();
} utils;

void	initscr();

#define PIXEL_CLEAR	0x80
#define PIXEL_SET	0x81
#define CURSOR_CLEAR	0X82
#define CURSOR_SET	0x83

unsigned char fontu[3][26 * 16] = {
  {0, 16, 56, 108, 198, 198, 198, 254, 198, 198, 198, 198, 198, 0, 0, 0,
   0, 248, 108, 102, 102, 102, 108, 120, 108, 102, 102, 108, 248, 0, 0, 0,
   0, 60, 102, 194, 192, 192, 192, 192, 192, 192, 194, 102, 60, 0, 0, 0,
   0, 248, 108, 102, 102, 102, 102, 102, 102, 102, 102, 108, 248, 0, 0, 0,
   0, 254, 102, 98, 96, 96, 104, 120, 104, 96, 98, 102, 254, 0, 0, 0,
   0, 254, 102, 98, 96, 96, 104, 120, 104, 96, 96, 96, 240, 0, 0, 0,
   0, 60, 102, 194, 192, 192, 192, 192, 192, 222, 194, 102, 58, 0, 0, 0,
   0, 198, 198, 198, 198, 198, 198, 254, 198, 198, 198, 198, 198, 0, 0, 0,
   0, 60, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 60, 0, 0, 0,
   0, 60, 24, 24, 24, 24, 24, 24, 24, 24, 152, 216, 112, 0, 0, 0,
   0, 230, 102, 102, 108, 108, 120, 120, 108, 108, 102, 102, 230, 0, 0, 0,
   0, 240, 96, 96, 96, 96, 96, 96, 96, 96, 98, 102, 254, 0, 0, 0,
   0, 198, 238, 254, 254, 214, 198, 198, 198, 198, 198, 198, 198, 0, 0, 0,
   0, 198, 230, 246, 254, 222, 206, 198, 198, 198, 198, 198, 198, 0, 0, 0,
   0, 56, 108, 198, 198, 198, 198, 198, 198, 198, 198, 108, 56, 0, 0, 0,
   0, 252, 102, 102, 102, 124, 96, 96, 96, 96, 96, 96, 240, 0, 0, 0,
   0, 124, 198, 198, 198, 198, 198, 198, 198, 198, 214, 222, 124, 12, 14, 0,
   0, 252, 102, 102, 102, 124, 108, 102, 102, 102, 102, 102, 230, 0, 0, 0,
   0, 60, 198, 198, 96, 56, 12, 6, 198, 198, 198, 108, 56, 0, 0, 0,
   0, 252, 252, 180, 48, 48, 48, 48, 48, 48, 48, 48, 120, 0, 0, 0,
   0, 198, 198, 198, 198, 198, 198, 198, 198, 198, 198, 198, 124, 0, 0, 0,
   0, 198, 198, 198, 198, 198, 198, 198, 198, 198, 108, 56, 16, 0, 0, 0,
   0, 198, 198, 198, 198, 198, 198, 198, 198, 214, 124, 108, 108, 0, 0, 0,
   0, 198, 198, 198, 108, 108, 56, 56, 108, 108, 198, 198, 198, 0, 0, 0,
   0, 102, 102, 102, 102, 102, 60, 24, 24, 24, 24, 24, 60, 0, 0, 0,
   0, 254, 198, 140, 12, 24, 24, 48, 48, 96, 98, 198, 254, 0, 0, 0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
  },
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
  }
};

unsigned char fontl[3][26 * 16] = {
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
  },
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
  },
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
  }
};

unsigned char fontn[4][10 * 16] = {
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
  },
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
  },
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
  },
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
  }
};

unsigned char fontpixel[8][4 * 16] = {
  { 255, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 255,
    255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
    255, 137, 137, 137, 137, 137, 137, 255, 137, 137, 137, 137, 137, 137, 137, 255,
    255, 247, 247, 247, 247, 247, 247, 129, 247, 247, 247, 247, 247, 247, 247, 255 }, //1
  { 255, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 255,
    255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
    255, 137, 137, 137, 137, 137, 137, 255, 137, 137, 137, 137, 137, 137, 137, 255,
    255, 247, 247, 247, 247, 247, 247, 129, 247, 247, 247, 247, 247, 247, 247, 255 }, //2
  { 255, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 255,
    255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
    255, 137, 137, 137, 137, 137, 137, 255, 137, 137, 137, 137, 137, 137, 137, 255,
    255, 247, 247, 247, 247, 247, 247, 129, 247, 247, 247, 247, 247, 247, 247, 255 }, //3
  { 255, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 255,
    255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
    255, 137, 137, 137, 137, 137, 137, 255, 137, 137, 137, 137, 137, 137, 137, 255,
    255, 247, 247, 247, 247, 247, 247, 129, 247, 247, 247, 247, 247, 247, 247, 255 }, //4
  { 255, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 255,
    255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
    255, 137, 137, 137, 137, 137, 137, 255, 137, 137, 137, 137, 137, 137, 137, 255,
    255, 247, 247, 247, 247, 247, 247, 129, 247, 247, 247, 247, 247, 247, 247, 255 }, //5
  { 255, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 255,
    255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
    255, 137, 137, 137, 137, 137, 137, 255, 137, 137, 137, 137, 137, 137, 137, 255,
    255, 247, 247, 247, 247, 247, 247, 129, 247, 247, 247, 247, 247, 247, 247, 255 }, //6
  { 255, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 255,
    255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
    255, 137, 137, 137, 137, 137, 137, 255, 137, 137, 137, 137, 137, 137, 137, 255,
    255, 247, 247, 247, 247, 247, 247, 129, 247, 247, 247, 247, 247, 247, 247, 255 }, //7
  { 255, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 129, 255,
    255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
    255, 137, 137, 137, 137, 137, 137, 255, 137, 137, 137, 137, 137, 137, 137, 255,
    255, 247, 247, 247, 247, 247, 247, 129, 247, 247, 247, 247, 247, 247, 247, 255 }  //8
};
